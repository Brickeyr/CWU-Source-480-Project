<!DOCTYPE html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.
-->
<!--Open html
    Param: lang = "en"
        Tells us to code in English. Not French, German, Japanese, Russian, Spanish, Hungarian, 
        Chinese, Hieroglyphic, Ancient Egyptian, Mayan, or Hawaiian. 
-->
<html lang="en">
    
    <!--Open html head-->
    <head>
        
        <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
        -->
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"/>
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        
        <!--Allow user to zoom on touch-screen devices
            Function: <meta name= "viewport" content="width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=3, user-scalable=1">
        
                Param: name = "viewport"
        
        
                Param: content="width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=3, user-scalable=1"
        
                    Arg: width=device-width
                        Sets the maximum width to the width of the devices default parameters
                
                    Arg: height=device-height
                        Sets the maximum height to the height of the devices default parameters
        
                    Arg: initial-scale=1
                        Sets the starting scale (when the user first enters the page) of the screen (how the user will view the screen) 
                        to 100% (not zoomed in, not zoomed out)
        
                    Arg: minimum-scale=1
                        Sets how far the user can zoom out to a minimum of 100%
        
                    Arg: maximum-scale=3
                        Sets how far the user can zoom in to a maximum of 300%
                        
                    Arg: user-scalable=1
                        Allows the user to zoom in and zoom out on the page
        -->
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, minimum-scale=1, maximum-scale=3, user-scalable=1">
        
        <!--Call jquery-3,1,1,js script
            Function: <script type="text/javascript" src="js/jquery-3.1.1.js"></script>
            
                Param: type="text/javascript"
                    Defines the script type as javascript
            
                Param:src="js/jquery-3.1.1.js"
                    Defines the script source to be js/jquery-3.1.1.js
                    js/jquery-3.1.1.js: The javascript jquery-3.1.1.js is located in the js file
        -->
        <script type="text/javascript" src="js/jquery-3.1.1.js"></script>
        
        <!--Call bootstrap.js script
            Function: <script type="text/javascript" src="js/bootstrap.js"></script>
            
                Param: type="text/javascript"
                    Defines the script type as javascript
            
                Param:src="js/bootstrap.js"
                    Defines the script source to be js/bootstrap.js
                    js/bootstrap.js: The javascript bootstrap.js is located in the js file
        -->
        <script type="text/javascript" src="js/bootstrap.js"></script>
        
        <!--Links the css stylesheet bootstap.min.css to the html page
            Function: <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        
                Param: rel="stylesheet"
                    Defines the relationship as a stylesheet
        
                Param: type="text/css"
                    Defines the type as a css stylesheet
                    
                Param: href="css/bootstrap.min.css"
                    Sets the reference point as bootstrap.min.css
                    css/bootstrap.min.css: bootstrap.min.css is located in the css folder
        -->
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        
        <!--Links the css stylesheet index.css to the html page
            Function: <link rel="stylesheet" type="text/css" href="css/index.css">
        
                Param: rel="stylesheet"
                    Defines the relationship as a stylesheet
        
                Param: type="text/css"
                    Defines the type as a css stylesheet
                    
                Param: href="css/index.css"
                    Sets the reference point as bootstrap.min.css
                    css/index.css: index.css is located in the css folder
        -->
        <link rel="stylesheet" type="text/css" href="css/index.css">
        
        <link rel="stylesheet" type="text/css" href="css/ScheduleL.css">
        
        <!--Creates the title for the webpage (the name of the website as viewed on a browser tab)
            Function: <title>CWU SOURCE</title>
            
                Arg: CWU SOURCE
                    The title name that will be displayed
        -->
        <title>CWU SOURCE</title>
        
        <!--Links the image CwuSource.ico to the html browser tab
            Function: <link rel="tab icon" type="image/x-icon" href="img/CwuSource.ico">
        
                Param: rel="tab icon"
                    Defines the relationship to the html page as the icon in the browser tab
        
                Param: type="image/x-icon"
                    Defines the type as an icon image
                    
                Param: href="img/CwuSource.ico"
                    Sets the reference point as img/CwuSource.ico
                    img/CwuSource.ico: CwuSource.ico is located in the img folder
        -->
        <link rel="tab icon" type="image/x-icon" href="img/CwuSource.ico">
        
        
    </head>
    <!--Close html head-->
    
    <!--Open html body-->
    <body>
        
        <!--Navigation bar with selectable subjects, bootstrapped
            Function: <nav class="navbar navbar-inverse">...</nav>
                
                Param: class = "navbar navbar-inverse"
                    Uses the css class navbar-inverse located in the index.css file
        -->
        <nav class="navbar navbar-inverse">
            
            <!--Opens div in navbar for a fluid container-->
            <div class="container-fluid">
                
                <!--Opens a div for the navbar header (leftmost navbar object)-->
                <div class="navbar-header">
                    
                    <!--Links the text CWU SOURCE to an html reference of index.html(website homepage)
                        Function: <a href="index.html" class="navbar-brand"><b>CWU SOURCE</b></a>
                    
                            Param: href = "index.html"
                                Sets the reference point as index.html
                    
                            Param: class = "navbar-brand"
                                Uses the css class navbar-brand located in the index.css file
                    
                            Param: <b>...</b>
                                Sets the included text to bold
                    
                            Arg: CWU SOURCE
                                The text to be displayed
                    -->
                    <a href="index.html" class="navbar-brand"><b>CWU SOURCE</b></a>
                    
                    <!--Creates a button that contains the dropdown menu when the page decreases in size
                        Function: <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainNavBar">...</button>
                    
                            Param: type = "button"
                                Defines the type as a button (clickable)
                    
                            Param: class = "navbar-toggle"
                                Uses the class navbar-toggle located in the bootstrap.min.css file
                    
                            Param: data-toggle = "collapse"
                                Allows the user to collapse the data (make it appear and disappear on the screen)
                    
                            Param: data-target = "#mainNavBar"
                                Gives the target location of this button                    
                    -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainNavBar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <!--Closes navbar header div-->
                
                <!--Creates a div for the collapsable navbar-->
                <div class="collapse navbar-collapse" id="mainNavBar">
                    
                    <!--Creates an unordered list that uses navbar-nav from the bootstrap.min.css file-->
                    <ul class="nav navbar-nav">
                        
                        <!--The following list elements are defined as such:
                            Function: <li><a href="EXAMPLE.html">EXAMPLE NAME</a></li>
                        
                                Param:<a href="EXAMPLE.html">...</a>
                                    Links the text to the html reference EXAMPLE.html
                                    (this will change depending on the name provided)
                        
                                Param:EXAMPLE NAME
                                    The clickable text that will appear in the navbar list
                                    (this will change depending on the name provided)
                        -->
                        <li><a href="ProgramGlance.html">Program At A Glance</a></li>
                        
                        <!--See Above For More Info-->
                        <li><a href="Schedule.html">Schedule</a></li>
                        
                        <!--<li><a href="ScheduleL.html">Schedule L</a></li>-->
                        
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About<span class="caret"></span>
                            </a>
                            
                            <!--Creates a nested unordered list to be used with the dropdown-menu class-->
                            <ul class="dropdown-menu">
                            
                                <!--See Above For More Info-->  
                                <li><a href="UnfinishedPage.html">President's Welcome</a></li>
                            
                                <!--See Above For More Info-->
                                <li><a href="Sponsors.html">Sponsors</a></li>
                            
                                <!--See Above For More Info-->
                                <li><a href="Judges.html">Judges</a></li>
                            
                                <!--See Above For More Info-->
                                <li><a href="SourceFacts.html">Source Facts</a></li>
                            
                                <!--See Above For More Info-->
                                <li><a href="WhenandWhere.html">When/Where</a></li>
                            </ul>
                            <!--Closes the nested list-->
                        </li>
                        <!--Closes the list element containing the nested list-->
                    </ul>
                    <!--Closes the unordered list-->
                </div>
                <!--Closes the div for the collapsable navbar-->
            </div>
            <!--Closes the div for the fluid container-->
            
        </nav>
        <!--Closes the navbar-->
        
        <div id="outTable"></div>
		<textarea id="in" cols = "30" rows="1" maxlength="128"></textarea>
		<button onclick="testquery()">Query</button>
        <script type="text/javascript">
		


        </script>


<table id="mytable" class="table table-condensed table-hover table-bordered">
	<thead>
		<tr>
			<th>Start Time</th>
			<th>Location</th>
			<th>Title</th>
		</tr>
	</thead>
</table>

<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="modalTitle"></h4>
      </div>
      <div class="modal-body">
      <!--
        <p><input type="text" class="input-sm" id="txtfname"/></p>
        <p><input type="text" class="input-sm" id="txtlname"/></p>
        <p><input type="text" class="input-sm" id="txtAname"/></p>
        -->
        <p id="date"></p>
        <p id="startTime"></p>
        <p id="location"></p>
        <p id="authors"></p>
        <p id="mentors"></p>
        <hr>
        <!--<p id="txtAname"></p> -->
        <p id="abstract"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script>

</script>

<script>

document.addEventListener('deviceready', onDeviceReady, false);

		var input = document.getElementById('in');
		var table = document.getElementById("mytable");
		var db;

		$('table').on('click', 'tr', function(e){
   			 $("#myModal").modal("show");
   			 //$("#txtfname").val($(this).closest('tr').children()[0].textContent);
   			 //$("#txtlname").val($(this).closest('tr').children()[1].textContent);
         $("#startTime").text("Start time: " + $(this).closest('tr').children()[0].textContent);
         $("#location").text("Location: " + $(this).closest('tr').children()[1].textContent);
         var title = "'" + $(this).closest('tr').children()[2].textContent + "'";
         $("#myModal").find('.modal-title').text($(this).closest('tr').children()[2].textContent);
         db.readTransaction(function (txn) {
            txn.executeSql('SELECT Abstract, Date, AuthorF1, AuthorL1, AuthorF2, AuthorL2, AuthorF3, AuthorL3, AuthorF4, AuthorL4, AuthorF5, AuthorL5 FROM data WHERE PanelTitle = ' + title, [], function (tx, res) {
                $("#abstract").text("Abstract: " + res.rows.item(0)["Abstract"]);
                $("#date").text("Date: " + res.rows.item(0)["Date"]);
                var authors = [];
                authors.push(res.rows.item(0)["AuthorF1"]); // 0
                authors.push(res.rows.item(0)["AuthorL1"]);
                authors.push(res.rows.item(0)["AuthorF2"]); // 2
                authors.push(res.rows.item(0)["AuthorL2"]);
                //alert("Author F2: " + authors[2]);
                //alert("Author L2: " + authors[3]);
                authors.push(res.rows.item(0)["AuthorF3"]); // 4
                authors.push(res.rows.item(0)["AuthorL3"]);
                authors.push(res.rows.item(0)["AuthorF4"]); // 6
                authors.push(res.rows.item(0)["AuthorL4"]);
                authors.push(res.rows.item(0)["AuthorF5"]); // 8
                authors.push(res.rows.item(0)["AuthorL5"]);
                $("#authors").text("Author(s): " );
                var authorz = document.getElementById('authors');
                if (authors[0] != "UNDEFINED") {
                  authorz.innerHTML = authorz.innerHTML + authors[0] + " " + authors[1];
                }
                for (var i = 2; i < authors.length - 1; i += 2) {
                  if (authors[i] !== UNDEFINED || authors[i] !== "" || authors[i] !== ''|| authors[i].length > 0 || authors[i] !== null || authors[i] !== "NULL") {
                    authorz.innerHTML = authorz.innerHTML + ", " + authors[i] + " " + authors[i+1];
                  }
                }
            });
            

         });
		});

		function testquery(){
     			db.readTransaction(function (txn) {
        			txn.executeSql('SELECT StartTime, Location, PanelTitle FROM data', [], function (tx, res) {
          				//output.value = "";
					var arr;
					deleteRows();
					for(var i = 0; i < res.rows.length; i++){
						arr = [res.rows.item(i)["StartTime"], res.rows.item(i)["Location"], res.rows.item(i)["PanelTitle"]];
						//output.value += res.rows.item(i)["AuthorF1"] + "\n";
						addRow(arr);
					}
        			});
      			});
		}

			function deleteRows(){
				while(table.rows.length > 1){
					table.deleteRow(1);
				}
			}

			function addRow(arr){
				var row = table.insertRow(-1);
				var cell;
				for(var i = 0; i < arr.length; i++){
					cell = row.insertCell(-1);
					cell.innerHTML = arr[i];
				}
			}

		function onDeviceReady(){
    			function copyDatabaseFile(dbName) {

      				var sourceFileName = cordova.file.applicationDirectory + 'www/' + dbName;
      				var targetDirName = cordova.file.dataDirectory;

      				return Promise.all([
					new Promise(function (resolve, reject) {
		  				resolveLocalFileSystemURL(sourceFileName, resolve, reject);
					}),
					new Promise(function (resolve, reject) {
          					resolveLocalFileSystemURL(targetDirName, resolve, reject);
        				})
      				]).then(function (files) {
					var sourceFile = files[0];
					var targetDir = files[1];
        				return new Promise(function (resolve, reject) {
          					targetDir.getFile(dbName, {}, resolve, reject);
        				}).then(function () {
          					console.log("file already copied");
        				}).catch(function () {
          					console.log("file doesn't exist, copying it");
          					return new Promise(function (resolve, reject) {
            					sourceFile.copyTo(targetDir, dbName, resolve, reject);
          				}).then(function () {
            					console.log("database file copied");
          				});
        				});
      					});
    			}

    			copyDatabaseFile('mydatabase.db').then(function () {
      			// success! :)
      			db = sqlitePlugin.openDatabase('mydatabase.db');
      			db.readTransaction(function (txn) {
        			txn.executeSql('SELECT AuthorF1 FROM data WHERE CAST(EntryID as integer) BETWEEN 1 AND 6', [], function (tx, res) {
          				console.log('Successfully read from pre-populated DB:');
					for(var i = 1; i < res.rows.length; i++){
          					//output.value += (JSON.stringify(res.rows.item(i))) + "\n";
					}
        			});
      			});
    			}).catch(function (err) {
      				// error! :(
      				console.log(err);
    			});
	

		}
	
</script>
        <script type="text/javascript" src="cordova.js"></script>
    </body>
</html>
